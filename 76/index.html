<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>리눅스 Nginx에서 Webdav 설정</title>
<meta
name="description"
content="정적페이지로 운영하는 개발 블로그입니다."
/>
<link
rel="shortcut icon"
type="image/png"
sizes="144x144"
href="/static/favicon-144x144.png"
/>
<link
rel="icon"
type="image/png"
sizes="16x16"
href="/static/favicon-16x16.png"
/>
<link
rel="icon"
type="image/png"
sizes="32x32"
href="/static/favicon-32x32.png"
/>
<link
rel="icon"
type="image/png"
sizes="192x192"
href="/static/favicon-192x192.png"
/>
<link
rel="apple-touch-icon"
sizes="57x57"
href="/static/apple-touch-icon-57x57.png"
/>
<link
rel="apple-touch-icon"
sizes="72x72"
href="/static/apple-touch-icon-72x72.png"
/>
<link
rel="apple-touch-icon"
sizes="76x76"
href="/static/apple-touch-icon-76x76.png"
/>
<link
rel="apple-touch-icon"
sizes="114x114"
href="/static/apple-touch-icon-114x114.png"
/>
<link
rel="apple-touch-icon"
sizes="120x120"
href="/static/apple-touch-icon-120x120.png"
/>
<link
rel="apple-touch-icon"
sizes="144x144"
href="/static/apple-touch-icon-144x144.png"
/>
<link
rel="apple-touch-icon"
sizes="152x152"
href="/static/apple-touch-icon-152x152.png"
/>
<link
rel="apple-touch-icon"
sizes="154x154"
href="/static/apple-touch-icon-154x154.png"
/>
<link
rel="apple-touch-icon"
sizes="180x180"
href="/static/apple-touch-icon-180x180.png"
/>
<link rel="stylesheet" href="/static/style.css">
<meta name="theme-color" content="#ff5722">
<meta property="og:type" content="website">
<meta property="og:title" content="리눅스 Nginx에서 Webdav 설정">
<meta property="og:description" content="공부한 개발 정보를 공유합니다.">
<meta property="og:image" content="https://devblog.lazyig.com/76//static/ogimg.png">
<meta property="og:url" content="https://devblog.lazyig.com/76/">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8149987977999297" crossorigin="anonymous"></script>
<link rel="stylesheet"
href="/static/highlight.css">
</head>
<body class="kigui one">
<header class="kigui header">
<div class="header-buttons">
<span id="headerBtn" class="nav-header-btn"><img src="/static/menu-w.svg" alt="Menu"></span>
</div>
<a href="/">
<h1 class="title">
메모용 개발 블로그
</h1>
</a>
</header>
<div class="kigui header-space"></div>
<section class="kigui">
<div id="navBar" class="nav-bar">

<div class="nav-header">
<span id="catToggle" class="nav-header-btn"><img src="/static/menu.svg" alt="Menu"></span>
</div>
<ul class="category">

<li style="padding-left: 0px">
<a href="/c/전체보기/1/">전체보기<span class="nav-cat-cnt">(114)</span></a>
</li>

<li style="padding-left: 15px">
<a href="/c/OS/1/">OS<span class="nav-cat-cnt">(35)</span></a>
</li>

<li style="padding-left: 30px">
<a href="/c/Linux/1/">Linux<span class="nav-cat-cnt">(23)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/MacOS/1/">MacOS<span class="nav-cat-cnt">(8)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/Windows/1/">Windows<span class="nav-cat-cnt">(4)</span></a>
</li>



<li style="padding-left: 15px">
<a href="/c/데이터베이스/1/">데이터베이스<span class="nav-cat-cnt">(3)</span></a>
</li>

<li style="padding-left: 30px">
<a href="/c/Oracle/1/">Oracle<span class="nav-cat-cnt">(1)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/Postgresql/1/">Postgresql<span class="nav-cat-cnt">(1)</span></a>
</li>



<li style="padding-left: 15px">
<a href="/c/Develop/1/">Develop<span class="nav-cat-cnt">(26)</span></a>
</li>

<li style="padding-left: 30px">
<a href="/c/CSS3/1/">CSS3<span class="nav-cat-cnt">(3)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/Go/1/">Go<span class="nav-cat-cnt">(8)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/HTML5/1/">HTML5<span class="nav-cat-cnt">(2)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/Java/1/">Java<span class="nav-cat-cnt">(1)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/JavaScript/1/">JavaScript<span class="nav-cat-cnt">(4)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/React/1/">React<span class="nav-cat-cnt">(2)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/Svelte/1/">Svelte<span class="nav-cat-cnt">(2)</span></a>
</li>



<li style="padding-left: 15px">
<a href="/c/개발일기/1/">개발일기<span class="nav-cat-cnt">(10)</span></a>
</li>


<li style="padding-left: 15px">
<a href="/c/Git/1/">Git<span class="nav-cat-cnt">(3)</span></a>
</li>


<li style="padding-left: 15px">
<a href="/c/GitLab/1/">GitLab<span class="nav-cat-cnt">(12)</span></a>
</li>


<li style="padding-left: 15px">
<a href="/c/Nginx/1/">Nginx<span class="nav-cat-cnt">(7)</span></a>
</li>


<li style="padding-left: 15px">
<a href="/c/기타/1/">기타<span class="nav-cat-cnt">(15)</span></a>
</li>


<li style="padding-left: 15px">
<a href="/c/이 블로그의 오픈소스/1/">이 블로그의 오픈소스<span class="nav-cat-cnt">(3)</span></a>
</li>



</ul>
</div>
<script>
let catToggle = document.getElementById("catToggle");
let headerBtn = document.getElementById("headerBtn");
let navBar = document.getElementById("navBar");
catToggle.addEventListener("click", () => {
navBar.classList.toggle("show");
});
headerBtn.addEventListener("click", () => {
navBar.classList.toggle("show");
})
</script>
<div class="kigui frame">
<p class="category-path">

<a href="/c/전체보기/1/">전체보기</a>
<span> > </span>

<a href="/c/Nginx/1/">Nginx</a>
<span> > </span>

</p>
<h1 class="article-title"><a href="https://devblog.lazyig.com/76/">리눅스 Nginx에서 Webdav 설정</a></h1>
<p class="write-date">2022-08-10 00:04:45</p>
<div class="markdown-body">
<p>Nginx에서 WebDav 설정을 간단하게 메모해보고자 한다.</p>
<h2>권한</h2>
<p>파일을 제공하려면 해당 경로에 권한이 존재하여야 한다.</p>
<p>webdav는 해당 웹 서버의 권한으로 동작하므로 이에 맞춰줄 필요가 있다.</p>
<p>여기서는 프로세스에서 동작하는 아이디를 보고 아이디를 확인했으며, 기본으로는 www-data이다.</p>
<pre><code>ps -ef | grep nginx
</code></pre>
<p>결과</p>
<pre><code>...
www-data 12688  1363  0 Aug02 ?        00:00:39 nginx: worker process
www-data 12689  1363  0 Aug02 ?        00:00:00 nginx: worker process
www-data 12690  1363  0 Aug02 ?        00:00:00 nginx: worker process
www-data 12691  1363  0 Aug02 ?        00:00:00 nginx: worker process
...
</code></pre>
<p>확인했다면 해당 경로의 소유주를 변경한다.</p>
<pre><code>sudo chown www-data:www-data 경로
</code></pre>
<p>만약 하위에 이미 파일이 존재한다면 -R 인수를 추가하여 하위 경로까지 재귀적으로 변경하도록 한다.</p>
<h2>Nginx 설치</h2>
<pre><code>sudo apt install nginx nginx-full -y
</code></pre>
<p>nginx-full로 설치하여 기능을 사용하여야 한다.</p>
<p>nginx 버전은 1.13.4 이상을 사용하여야 한다.</p>
<p><a href="https://github.com/arut/nginx-dav-ext-module">https://github.com/arut/nginx-dav-ext-module</a></p>
<p>(앞으로 나올 각종 설정들의 항목이 위 레포에 설명이 친절히 되어 있다.)</p>
<hr>
<p>개인적인 이슈인지는 모르겠으나. Nginx 1.14.0 버전을 패키지 매니저로 설치하여 구성하다가 일반 구성은 정상으로 되나, 맥에서 쓰기를 정상적으로 하기 위해서 nginx dav ext module을 적용하는 과정에서 제대로 동작하지 않아 결국 컴파일 설치로 대체하였습니다.</p>
<p>혹시나 동일 증상인 경우 해당 글을 참고하여 Nginx를 컴파일로 구성해보시기 바랍니다.</p>
<p><a href="/75">Nginx 1.19.0 컴파일 방식으로 설치</a></p>
<h2>Nginx 설정</h2>
<p>webdav는 http 프로토콜에서 동작하므로 Nginx에서 http 블록 내부에 설정이 위치하면 된다.</p>
<p>대부분의 경우 /etc/nginx/sites-enabled 경로 하위의 파일을 http 블록 내부에 불러오도록 설정이 되어 있을 것이다.</p>
<p>이 글도 이를 기준으로 작성하지만, 혹여나 환경이 다르다면 그냥 /etc/nginx/nginx.conf 에다가 비슷하게 세팅을 하던지 http 블록 아래 그대로 넣어버리던지 하면 된다.</p>
<p>보통의 경우 /etc/nginx/sites-available 아래 설정파일을 작성해서 넣고 sites-enabled로 심볼릭 링크를 추가하여 활성화하는 식으로 사용한다.</p>
<h3>설정 파일 추가</h3>
<pre><code>sudo vim /etc/nginx/sites-available/도메인_주소
</code></pre>
<p>관리상 목적으로 파일 명을 도메인 주소로 설정하였다. 본인이 편리한 규칙대로 작성을 해도 무관하다.</p>
<p>다음 내용처럼 작성한다.</p>
<p>(WebDav 레벨 2를 지원하기 위해서 dav_ext_methods 설정을 포함하고 있습니다. 이를 추가하지 않은 경우 관련 모듈 부재로 인하여 에러 발생할 수 있음.)</p>
<pre><code class="language-nginx"><span class="hljs-attribute">dav_ext_lock_zone</span> zone=foo:<span class="hljs-number">10m</span>;

<span class="hljs-section">server</span> {
    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;
    <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">80</span>;

    <span class="hljs-attribute">server_name</span> 도메인_주소;
    
    <span class="hljs-attribute">charset</span> utf-<span class="hljs-number">8</span>;
  
    <span class="hljs-section">location</span> / {
        <span class="hljs-attribute">alias</span> 웹_루트_주소;
        <span class="hljs-attribute">set</span> <span class="hljs-variable">$x</span> <span class="hljs-variable">$uri</span><span class="hljs-variable">$request_method</span>;
        <span class="hljs-attribute">if</span> (<span class="hljs-variable">$x</span> <span class="hljs-regexp">~ [^/]MKCOL$)</span> {
            <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*)$</span> <span class="hljs-variable">$1</span>/;
        }

        <span class="hljs-attribute">autoindex</span> <span class="hljs-literal">on</span>;
        <span class="hljs-attribute">auth_basic</span> <span class="hljs-string">&quot;Restricted Access&quot;</span>;
        <span class="hljs-attribute">auth_basic_user_file</span> /etc/nginx/.htpasswd;
        <span class="hljs-attribute">client_body_temp_path</span> /tmp;
        <span class="hljs-attribute">dav_methods</span> PUT DELETE MKCOL COPY MOVE;
        <span class="hljs-attribute">dav_ext_methods</span> PROPFIND OPTIONS LOCK UNLOCK;
        <span class="hljs-attribute">dav_ext_lock</span> zone=foo;
        <span class="hljs-attribute">dav_access</span> user:rw group:rw all:r;
    }
}
</code></pre>
<p>이후 sites-enabled 경로로 심볼릭 링크를 생성한다.</p>
<pre><code>sudo ln -s /etc/nginx/sites-available/파일명 /etc/nginx/sites-enabled/파일명
</code></pre>
<p>Nginx 문법 검사를 수행하여 이상이 없는지 확인한다.</p>
<pre><code>sudo nginx -t
</code></pre>
<p>결과</p>
<pre><code>➜  nginx sudo nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
</code></pre>

</div>
</div>
<div class="kigui frame">
<script src="https://utteranc.es/client.js"
repo="lazyig/blog-comment"
issue-term="pathname"
label="blog-comment"
theme="github-light"
crossorigin="anonymous"
async>
</script>
</div>
</section>
</body>
</html>