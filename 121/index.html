<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Go HTTP 유닉스 소켓</title>
<meta
name="description"
content="정적페이지로 운영하는 개발 블로그입니다."
/>
<link
rel="shortcut icon"
type="image/png"
sizes="144x144"
href="/static/favicon-144x144.png"
/>
<link
rel="icon"
type="image/png"
sizes="16x16"
href="/static/favicon-16x16.png"
/>
<link
rel="icon"
type="image/png"
sizes="32x32"
href="/static/favicon-32x32.png"
/>
<link
rel="icon"
type="image/png"
sizes="192x192"
href="/static/favicon-192x192.png"
/>
<link
rel="apple-touch-icon"
sizes="57x57"
href="/static/apple-touch-icon-57x57.png"
/>
<link
rel="apple-touch-icon"
sizes="72x72"
href="/static/apple-touch-icon-72x72.png"
/>
<link
rel="apple-touch-icon"
sizes="76x76"
href="/static/apple-touch-icon-76x76.png"
/>
<link
rel="apple-touch-icon"
sizes="114x114"
href="/static/apple-touch-icon-114x114.png"
/>
<link
rel="apple-touch-icon"
sizes="120x120"
href="/static/apple-touch-icon-120x120.png"
/>
<link
rel="apple-touch-icon"
sizes="144x144"
href="/static/apple-touch-icon-144x144.png"
/>
<link
rel="apple-touch-icon"
sizes="152x152"
href="/static/apple-touch-icon-152x152.png"
/>
<link
rel="apple-touch-icon"
sizes="154x154"
href="/static/apple-touch-icon-154x154.png"
/>
<link
rel="apple-touch-icon"
sizes="180x180"
href="/static/apple-touch-icon-180x180.png"
/>
<link rel="stylesheet" href="/static/style.css">
<meta name="theme-color" content="#ff5722">
<meta property="og:type" content="website">
<meta property="og:title" content="Go HTTP 유닉스 소켓">
<meta property="og:description" content="공부한 개발 정보를 공유합니다.">
<meta property="og:image" content="https://devblog.lazyig.com/121//static/ogimg.png">
<meta property="og:url" content="https://devblog.lazyig.com/121/">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8149987977999297" crossorigin="anonymous"></script>
<link rel="stylesheet"
href="/static/highlight.css">
</head>
<body class="kigui one">
<header class="kigui header">
<div class="header-buttons">
<span id="headerBtn" class="nav-header-btn"><img src="/static/menu-w.svg" alt="Menu"></span>
</div>
<a href="/">
<h1 class="title">
메모용 개발 블로그
</h1>
</a>
</header>
<div class="kigui header-space"></div>
<section class="kigui">
<div id="navBar" class="nav-bar">

<div class="nav-header">
<span id="catToggle" class="nav-header-btn"><img src="/static/menu.svg" alt="Menu"></span>
</div>
<ul class="category">

<li style="padding-left: 0px">
<a href="/c/전체보기/1/">전체보기<span class="nav-cat-cnt">(113)</span></a>
</li>

<li style="padding-left: 15px">
<a href="/c/OS/1/">OS<span class="nav-cat-cnt">(35)</span></a>
</li>

<li style="padding-left: 30px">
<a href="/c/Linux/1/">Linux<span class="nav-cat-cnt">(23)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/MacOS/1/">MacOS<span class="nav-cat-cnt">(8)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/Windows/1/">Windows<span class="nav-cat-cnt">(4)</span></a>
</li>



<li style="padding-left: 15px">
<a href="/c/데이터베이스/1/">데이터베이스<span class="nav-cat-cnt">(3)</span></a>
</li>

<li style="padding-left: 30px">
<a href="/c/Oracle/1/">Oracle<span class="nav-cat-cnt">(1)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/Postgresql/1/">Postgresql<span class="nav-cat-cnt">(1)</span></a>
</li>



<li style="padding-left: 15px">
<a href="/c/Develop/1/">Develop<span class="nav-cat-cnt">(25)</span></a>
</li>

<li style="padding-left: 30px">
<a href="/c/CSS3/1/">CSS3<span class="nav-cat-cnt">(3)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/Go/1/">Go<span class="nav-cat-cnt">(8)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/HTML5/1/">HTML5<span class="nav-cat-cnt">(2)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/Java/1/">Java<span class="nav-cat-cnt">(1)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/JavaScript/1/">JavaScript<span class="nav-cat-cnt">(4)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/React/1/">React<span class="nav-cat-cnt">(2)</span></a>
</li>


<li style="padding-left: 30px">
<a href="/c/Svelte/1/">Svelte<span class="nav-cat-cnt">(2)</span></a>
</li>



<li style="padding-left: 15px">
<a href="/c/개발일기/1/">개발일기<span class="nav-cat-cnt">(10)</span></a>
</li>


<li style="padding-left: 15px">
<a href="/c/Git/1/">Git<span class="nav-cat-cnt">(3)</span></a>
</li>


<li style="padding-left: 15px">
<a href="/c/GitLab/1/">GitLab<span class="nav-cat-cnt">(12)</span></a>
</li>


<li style="padding-left: 15px">
<a href="/c/Nginx/1/">Nginx<span class="nav-cat-cnt">(7)</span></a>
</li>


<li style="padding-left: 15px">
<a href="/c/기타/1/">기타<span class="nav-cat-cnt">(15)</span></a>
</li>


<li style="padding-left: 15px">
<a href="/c/이 블로그의 오픈소스/1/">이 블로그의 오픈소스<span class="nav-cat-cnt">(3)</span></a>
</li>



</ul>
</div>
<script>
let catToggle = document.getElementById("catToggle");
let headerBtn = document.getElementById("headerBtn");
let navBar = document.getElementById("navBar");
catToggle.addEventListener("click", () => {
navBar.classList.toggle("show");
});
headerBtn.addEventListener("click", () => {
navBar.classList.toggle("show");
})
</script>
<div class="kigui frame">
<p class="category-path">

<a href="/c/전체보기/1/">전체보기</a>
<span> > </span>

<a href="/c/Develop/1/">Develop</a>
<span> > </span>

<a href="/c/Go/1/">Go</a>
<span> > </span>

</p>
<h1 class="article-title"><a href="https://devblog.lazyig.com/121/">Go HTTP 유닉스 소켓</a></h1>
<p class="write-date">2024-05-20 15:21:38</p>
<div class="markdown-body">
<h2>유닉스 도메인 소켓(Unix Domain Socket)</h2>
<p>유닉스 도메인 소켓(Unix domain socket)은 유닉스 계열 운영체제에서 프로세스간 통신에 사용되는 소켓이다.</p>
<p>흔히 통신을 위해서 사용하는 TCP/UDP 통신의 경우 네트워크 상의 다른 컴퓨터와 통신이 가능하지만 유닉스 도메인 소켓은 프로세스간 통신에 사용되는 만큼 로컬에서만 사용가능하다.</p>
<p>Unix domain socket은 TCP/UDP 통신에 비해서 과정이 간략하여 같은 기기 내 통신이라면 선택하기 좋다.</p>
<h2>Go</h2>
<p>Go 언어에서 유닉스 도메인 소켓을 활용하여 통신을 한 것을 남기고자 한다.</p>
<p>편하게 관리하기 위해서 유닉스 도메인 소켓에서 HTTP 통신을 하는 예제이다.</p>
<h3>Client</h3>
<p><code>client.go</code></p>
<pre><code class="language-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;context&quot;</span>
	<span class="hljs-string">&quot;io&quot;</span>
	<span class="hljs-string">&quot;log&quot;</span>
	<span class="hljs-string">&quot;net&quot;</span>
	<span class="hljs-string">&quot;net/http&quot;</span>
)

<span class="hljs-comment">// SockFilePath 유닉스 도메인 소켓 파일 경로</span>
<span class="hljs-keyword">var</span> SockFilePath <span class="hljs-type">string</span> = <span class="hljs-string">&quot;./ping-server.sock&quot;</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// http 클라이언트 생성, 유닉스 도메인 소켓으로 연결</span>
	client := http.Client{
		Transport: &amp;http.Transport{
			DialContext: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(_ context.Context, _, _ <span class="hljs-type">string</span>)</span></span> (net.Conn, <span class="hljs-type">error</span>) {
				<span class="hljs-keyword">return</span> net.Dial(<span class="hljs-string">&quot;unix&quot;</span>, SockFilePath)
			},
		},
	}

	<span class="hljs-comment">// 요청 송신</span>
	resp, err := client.Post(<span class="hljs-string">&quot;http://unix/ping&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-literal">nil</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-built_in">panic</span>(err)
	}
	<span class="hljs-keyword">defer</span> resp.Body.Close()

	<span class="hljs-comment">// 응답 읽기</span>
	body, err := io.ReadAll(resp.Body)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-built_in">panic</span>(err)
	}

	log.Println(<span class="hljs-type">string</span>(body))
}

</code></pre>
<h3>Server</h3>
<p><code>server.go</code></p>
<pre><code class="language-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;log&quot;</span>
	<span class="hljs-string">&quot;net&quot;</span>
	<span class="hljs-string">&quot;net/http&quot;</span>
	<span class="hljs-string">&quot;os&quot;</span>
	<span class="hljs-string">&quot;os/signal&quot;</span>
	<span class="hljs-string">&quot;syscall&quot;</span>
)

<span class="hljs-comment">// SockFilePath 유닉스 도메인 소켓 파일 경로</span>
<span class="hljs-keyword">var</span> SockFilePath <span class="hljs-type">string</span> = <span class="hljs-string">&quot;./ping-server.sock&quot;</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// 유닉스 도메인 소켓 파일 생성, 수신 대기</span>
	socket, err := net.Listen(<span class="hljs-string">&quot;unix&quot;</span>, SockFilePath)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(err)
	}

	<span class="hljs-comment">// 종료 시 소켓 파일 제거</span>
	c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)
	signal.Notify(c, os.Interrupt, syscall.SIGTERM)
	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
		&lt;-c
		os.Remove(SockFilePath)
		os.Exit(<span class="hljs-number">1</span>)
	}()

	mux := http.NewServeMux()

	<span class="hljs-comment">// Post 요청 핸들러 등록</span>
	mux.HandleFunc(<span class="hljs-string">&quot;POST /ping&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
		w.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;pong!&quot;</span>))
	})

	server := http.Server{
		Handler: mux,
	}

	<span class="hljs-comment">// 유닉스 도메인 소켓으로 서버 시작</span>
	err = server.Serve(socket)

	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatalln(err)
	}
}

</code></pre>

</div>
</div>
<div class="kigui frame">
<script src="https://utteranc.es/client.js"
repo="lazyig/blog-comment"
issue-term="pathname"
label="blog-comment"
theme="github-light"
crossorigin="anonymous"
async>
</script>
</div>
</section>
</body>
</html>